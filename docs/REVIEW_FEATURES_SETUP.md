# è¯„ä»·åŠŸèƒ½å®Œæ•´è®¾ç½®æŒ‡å—
## Complete Review Features Setup Guide

### âœ… å·²å®ç°åŠŸèƒ½

1. **åŒ¿åè¯„ä»·** - ç”¨æˆ·å¯ä»¥é€‰æ‹©åŒ¿åå¡«å†™è¯„ä»·
2. **ç‚¹èµ/ä¸æ¨è** - ç”¨æˆ·å¯ä»¥å¯¹è¯„ä»·è¿›è¡Œç‚¹èµæˆ–ä¸æ¨è
3. **ä¸¾æŠ¥åŠŸèƒ½** - ç”¨æˆ·å¯ä»¥ä¸¾æŠ¥ä¸å½“è¯„ä»·
4. **æ€»å°ç®¡ç†** - ç®¡ç†å‘˜å¯ä»¥åœ¨æ€»å°dashboardæŸ¥çœ‹å’Œå¤„ç†ä¸¾æŠ¥
5. **æ’åºä¼˜åŒ–** - è¯„ä»·å¯ä»¥æŒ‰ç‚¹èµé‡æ’åºï¼ˆæœ€å—æ¬¢è¿ï¼‰

### ğŸ“‹ æ•°æ®åº“è®¾ç½®æ­¥éª¤

#### 1. æ‰§è¡Œ SQL è„šæœ¬

åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œ `supabase/review-reactions-schema.sql`ï¼š

```sql
-- è¿™ä¸ªè„šæœ¬ä¼šï¼š
-- 1. åˆ›å»º review_reactions è¡¨ï¼ˆç‚¹èµ/ä¸æ¨èï¼‰
-- 2. åˆ›å»º review_reports è¡¨ï¼ˆä¸¾æŠ¥ï¼‰
-- 3. æ›´æ–° reviews è¡¨ï¼ˆæ·»åŠ  is_anonymous, like_count, dislike_countï¼‰
-- 4. åˆ›å»ºè§¦å‘å™¨ï¼ˆè‡ªåŠ¨æ›´æ–°ç»Ÿè®¡ï¼‰
-- 5. åˆ›å»ºè§†å›¾ï¼ˆä¸¾æŠ¥ç»Ÿè®¡ï¼‰
-- 6. è®¾ç½® RLS ç­–ç•¥
```

#### 2. éªŒè¯è¡¨ç»“æ„

æ‰§è¡Œåï¼Œç¡®è®¤ä»¥ä¸‹è¡¨å·²åˆ›å»ºï¼š
- âœ… `review_reactions`
- âœ… `review_reports`
- âœ… `reviews` è¡¨å·²æ›´æ–°ï¼ˆæ–°å¢å­—æ®µï¼‰

### ğŸ”§ API ç«¯ç‚¹

#### è¯„ä»·ååº” API

- **POST** `/api/reviews/reactions` - åˆ›å»º/æ›´æ–°/åˆ é™¤ååº”
- **GET** `/api/reviews/reactions?reviewId=xxx&userId=xxx` - è·å–ååº”ç»Ÿè®¡

#### è¯„ä»·ä¸¾æŠ¥ API

- **POST** `/api/reviews/reports` - åˆ›å»ºä¸¾æŠ¥
- **GET** `/api/reviews/reports` - è·å–ä¸¾æŠ¥åˆ—è¡¨ï¼ˆç®¡ç†å‘˜ï¼‰
- **PATCH** `/api/reviews/reports/[id]` - æ›´æ–°ä¸¾æŠ¥çŠ¶æ€ï¼ˆç®¡ç†å‘˜ï¼‰

### ğŸ¨ å‰ç«¯åŠŸèƒ½

#### ç”¨æˆ·ç«¯

1. **å†™è¯„ä»·**
   - å‹¾é€‰"åŒ¿åå¡«å†™"å¤é€‰æ¡†
   - æäº¤æ—¶åŒ…å« `isAnonymous` å­—æ®µ

2. **äº’åŠ¨è¯„ä»·**
   - ç‚¹å‡»"ç‚¹èµ"æŒ‰é’®ï¼ˆè“è‰²ï¼‰
   - ç‚¹å‡»"ä¸æ¨è"æŒ‰é’®ï¼ˆçº¢è‰²ï¼‰
   - æ˜¾ç¤ºååº”æ•°é‡
   - å¯ä»¥åˆ‡æ¢æˆ–å–æ¶ˆååº”

3. **ä¸¾æŠ¥è¯„ä»·**
   - ç‚¹å‡»"ä¸¾æŠ¥"æŒ‰é’®
   - é€‰æ‹©ä¸¾æŠ¥åŸå› 
   - å¡«å†™ä¸¾æŠ¥è¯´æ˜

4. **æ’åºé€‰é¡¹**
   - æœ€æ–°
   - è¯„åˆ†æœ€é«˜
   - è¯„åˆ†æœ€ä½
   - **æœ€å—æ¬¢è¿**ï¼ˆæŒ‰ç‚¹èµé‡ï¼‰
   - æœ‰ç…§ç‰‡ä¼˜å…ˆ

#### ç®¡ç†å‘˜ç«¯

1. **è®¿é—®ä¸¾æŠ¥ç®¡ç†**
   - è·¯å¾„ï¼š`/admin/reports`
   - åœ¨æ€»å°èœå•ä¸­å·²æ·»åŠ "è¯„ä»·ä¸¾æŠ¥"é€‰é¡¹

2. **æŸ¥çœ‹ä¸¾æŠ¥**
   - æŸ¥çœ‹æ‰€æœ‰ä¸¾æŠ¥åˆ—è¡¨
   - æŸ¥çœ‹ä¸¾æŠ¥ç»Ÿè®¡ï¼ˆå¾…å¤„ç†ã€å®¡æ ¸ä¸­ã€å·²å¤„ç†ç­‰ï¼‰
   - æ”¯æŒçŠ¶æ€ç­›é€‰

3. **å¤„ç†ä¸¾æŠ¥**
   - ç‚¹å‡»"å¼€å§‹å®¡æ ¸"
   - æ·»åŠ å¤„ç†å¤‡æ³¨
   - æ›´æ–°ä¸¾æŠ¥çŠ¶æ€ï¼ˆå®Œæˆå¤„ç†æˆ–é©³å›ï¼‰

### ğŸ“Š æ•°æ®è¡¨ç»“æ„

#### `review_reactions` è¡¨

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | UUID | ä¸»é”® |
| `review_id` | UUID | è¯„ä»·ID |
| `user_id` | UUID | ç”¨æˆ·ID |
| `reaction_type` | TEXT | 'like' æˆ– 'dislike' |
| `created_at` | TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| `updated_at` | TIMESTAMP | æ›´æ–°æ—¶é—´ |

#### `review_reports` è¡¨

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | UUID | ä¸»é”® |
| `review_id` | UUID | è¯„ä»·ID |
| `reporter_id` | UUID | ä¸¾æŠ¥äººID |
| `reason` | TEXT | ä¸¾æŠ¥åŸå›  |
| `description` | TEXT | ä¸¾æŠ¥è¯¦æƒ… |
| `status` | TEXT | çŠ¶æ€ï¼ˆpending/reviewing/resolved/dismissedï¼‰ |
| `handled_by` | UUID | å¤„ç†äººID |
| `handled_at` | TIMESTAMP | å¤„ç†æ—¶é—´ |
| `handling_notes` | TEXT | å¤„ç†å¤‡æ³¨ |

#### `reviews` è¡¨ï¼ˆæ–°å¢å­—æ®µï¼‰

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `is_anonymous` | BOOLEAN | æ˜¯å¦åŒ¿å |
| `like_count` | INTEGER | ç‚¹èµæ•° |
| `dislike_count` | INTEGER | ä¸æ¨èæ•° |

### ğŸ”’ æƒé™æ§åˆ¶

#### RLS ç­–ç•¥

- âœ… ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ååº”
- âœ… ç”¨æˆ·åªèƒ½åˆ›å»º/æ›´æ–°/åˆ é™¤è‡ªå·±çš„ååº”
- âœ… ç”¨æˆ·å¯ä»¥åˆ›å»ºä¸¾æŠ¥
- âœ… ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„ä¸¾æŠ¥
- âœ… ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ä¸¾æŠ¥
- âœ… ç®¡ç†å‘˜å¯ä»¥æ›´æ–°ä¸¾æŠ¥çŠ¶æ€

### ğŸ“ ä½¿ç”¨ç¤ºä¾‹

#### åˆ›å»ºååº”

```typescript
// ç‚¹èµ
await fetch('/api/reviews/reactions', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    reviewId: 'review-uuid',
    reactionType: 'like',
  }),
});
```

#### åˆ›å»ºä¸¾æŠ¥

```typescript
await fetch('/api/reviews/reports', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    reviewId: 'review-uuid',
    reason: 'inappropriate',
    description: 'ä¸å½“å†…å®¹',
  }),
});
```

### âœ… å®Œæˆæ£€æŸ¥æ¸…å•

- âœ… æ•°æ®åº“è¡¨ç»“æ„åˆ›å»º
- âœ… API ç«¯ç‚¹å®ç°
- âœ… å‰ç«¯ç»„ä»¶æ›´æ–°
- âœ… æ€»å°ç®¡ç†é¡µé¢
- âœ… æ’åºé€»è¾‘æ›´æ–°
- âœ… RLS ç­–ç•¥è®¾ç½®
- âœ… è§¦å‘å™¨è‡ªåŠ¨æ›´æ–°ç»Ÿè®¡
- âš ï¸ åœ¨ Supabase ä¸­æ‰§è¡Œ SQL è„šæœ¬ï¼ˆéœ€è¦æ‰‹åŠ¨æ‰§è¡Œï¼‰

### ğŸš€ ä¸‹ä¸€æ­¥

1. **æ‰§è¡Œ SQL è„šæœ¬**
   - åœ¨ Supabase Dashboard â†’ SQL Editor
   - æ‰§è¡Œ `supabase/review-reactions-schema.sql`

2. **æµ‹è¯•åŠŸèƒ½**
   - æµ‹è¯•åŒ¿åè¯„ä»·
   - æµ‹è¯•ç‚¹èµ/ä¸æ¨è
   - æµ‹è¯•ä¸¾æŠ¥åŠŸèƒ½
   - æµ‹è¯•æ€»å°ç®¡ç†

3. **é…ç½®æƒé™**
   - ç¡®ä¿ RLS ç­–ç•¥æ­£ç¡®è®¾ç½®
   - ç¡®ä¿ç®¡ç†å‘˜å¯ä»¥è®¿é—® `/admin/reports`

---

**æœ€åæ›´æ–°**: 2024å¹´

